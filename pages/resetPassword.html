<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="../assets/css/resetPassword.css">


</head>



<body>
    <div class="Title">Needs To Be Done</div>
    <div>
        <div class="form">
            <form id="form">
                <input type="text" id="emailId" placeholder="Email id" disabled />
                <input type="password" id="newPwd" placeholder="New Password" required />
                <input type="password" id="retypenewPwd" placeholder="Retype Password" required />
                <button type="submit">Reset</button><br><br>
                <button onclick="logIn()">Login</button>
                <!--<p class="message">Not registered? <a href="#">Create an account</a></p>-->
            </form>
        </div>
    </div>

    <script src="../assets/JS/resetPwd.js"></script>

    <script>
        // To set the current email in the email input box
        document.getElementById("emailId").value = JSON.parse(localStorage.getItem("forgotEmail"));
        // To access the form id for add a addEventListener for the form
        document.getElementById("form").addEventListener("submit", (event) => {
            event.preventDefault();
            try {
                // To get the current email
                let email = JSON.parse(localStorage.getItem("forgotEmail"));

                //    find email in all user emails

                let allEmail = JSON.parse(localStorage.getItem("allEmail"));

                let allEmailFinded = false;

                for (let i = 0; i < allEmail.length; i++) {
                    if (email == allEmail[i]) {
                        allEmailFinded = true;
                        break;
                    }
                }

                //   change the password
                if (allEmailFinded == true) {
                    // check the user type

                    let ownerReg = JSON.parse(localStorage.getItem("register"));
                    let workerReg = JSON.parse(localStorage.getItem("workerRegister"));

                    let ownerRegFinded = ownerReg.find((F) => F.Email == email);
                    let workerRegFinded = workerReg.find((F) => F.Email == email);
                    // To change the password for the respective user
                    if (ownerRegFinded != undefined) {
                        let ownerRegFindedIndex = ownerReg.indexOf(ownerRegFinded);
                        ownerRegFinded.Password = document.getElementById("newPwd").value;
                        ownerRegFinded.RPassword = document.getElementById("retypenewPwd").value;
                        ownerReg[ownerRegFindedIndex] = ownerRegFinded;
                        localStorage.setItem("register", JSON.stringify(ownerReg));
                        alert("Password changed successfuly");
                        location.href = "Signin.html";
                    } else {
                        let workerRegFindedIndex = workerReg.indexOf(workerRegFinded);
                        workerRegFinded.Password = document.getElementById("newPwd").value;
                        workerRegFinded.RPassword = document.getElementById("retypenewPwd").value;
                        workerReg[workerRegFindedIndex] = workerRegFinded;
                        localStorage.setItem("register", JSON.stringify(workerReg));
                        alert("Password changed successfuly");
                        location.href = "Signin.html";
                    }
                } else {
                    alert("Invalid Email Id ");
                }
            }
            catch (err) {
                console.error(err);
            }
        })
    </script>
</body>

</html>