<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OwnerNotification</title>
    <link rel="stylesheet" href="../assets/css/ownerhome.css">
    <link rel="stylesheet" href="../assets/css/ownerNotification.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700;800&family=Barlow:wght@400;700&family=Outfit:wght@300&family=Roboto+Mono:ital,wght@0,300;1,300&family=Roboto+Slab:wght@300&family=Space+Mono:wght@700&display=swap"
        rel="stylesheet">


</head>

<body>
    <script src="../assets/JS/index.js"></script>
    <script src="../assets/JS/ownerNotification.js"></script>


    <header>
        <div>
            <img src="../assets/Images/logo-transparent-svg.svg" alt="Logo">
        </div>

        <nav>
            <div>
                <a onclick="urlNotif()"><span>Home</span></a>
                <!-- <a>Search</a> -->
                <a onclick="redirectChat()"><span>Chat</span></a>
                <a><span>Notification</span></a>
                <a onclick="payment()"> <span>payment</span></a>
                <a onclick="urlData()"> <span> profile</span></a>
                <a href="../index.html" style="background-color: #c84449;"><span>LogOut</span></a>
            </div>
        </nav>
    </header>

    <main>
        <section>
            <div class="notificationEntire">
                <div class="notificationTop">

                    <div class="profile">
                        <p class="user_name">kamalesh</p>

                    </div>

                    <div class="types">
                        <a id="ftrbtn">Filter</a>
                    </div>

                    <select name="" id="filter" class="filter">
                        <option value="All">All</option>
                        <option value="Read">Read</option>
                        <option value="Unread">Unread</option>

                    </select>
                </div>
            </div>



            </div>



        </section>

        <section class="secS">
        </section>
    </main>
    <script>

        // Filter button to set the type of filter in the url

        document.getElementById("ftrbtn").addEventListener("click", (event) => {
            try {
                let clicked = document.getElementById("filter").value;
                if (clicked == "All") {
                    filterAll()
                }
                if (clicked == "Read") {
                    filterRead()
                }
                if (clicked == "Unread") {
                    filterUnread()
                }
            }
            catch (err) {
                console.error(err);
            }

        })

        //  To create the header of the user in the notification header

        let Login = JSON.parse(localStorage.getItem("Login"));
        let Bio = JSON.parse(localStorage.getItem("BIO"));

        let findedBio = Bio.find((F) => F.Email == Login.Email);

        let cntProfileImg = document.createElement("img");
        // To create a image of the user with their names first two letter
        cntProfileImg.setAttribute("src", profileImg(findedBio["FN"], findedBio["LN"]));
        cntProfileImg.setAttribute("alt", "image");
        document.querySelector(".profile").prepend(cntProfileImg);

        document.querySelector(".user_name").innerHTML = findedBio["FN"] + " " + findedBio["LN"];


        //  Notification

        // filters



        // url data


        let url = location.search;
        let urlParams = new URLSearchParams(url);
        let filter = urlParams.get("filter");
        console.log(filter);

        let getApplyJOb = JSON.parse(localStorage.getItem("apllyJob"))
        console.log(getApplyJOb);
        let currentOwner = JSON.parse(localStorage.getItem("Login"))
        console.log(currentOwner.id);
        console.log(getApplyJOb);

        // To seperate the datas with filtered conditons
        let applyJobAll = getApplyJOb.filter((J) => J["ownerId"] == currentOwner.id);
        console.log(applyJobAll);
        let applyJobReaded = applyJobAll.filter((J) => J["readed"] == true);
        console.log(applyJobReaded);
        let applyJobUnread = applyJobAll.filter((J) => J["readed"] == false);
        console.log(applyJobUnread);
        let applyJob;
        if (filter == "all") {
            applyJob = applyJobAll;
        }
        else if (filter == "readed") {
            applyJob = applyJobReaded;
        }
        else {
            applyJob = applyJobUnread;
        }
        console.log(applyJob)


        //   Create the notification module with the filtered data
        for (let i = 0; i < applyJob.length; i++) {
            let notifications = document.createElement("div");
            notifications.setAttribute("class", "notifications");

            let notifyCards = document.createElement("div");
            notifyCards.setAttribute("class", "notifyCards");
            notifications.append(notifyCards);

            let notifyCardsImage = document.createElement("img");
            let imageProfile = profileImg(applyJob[i]["applierName"], applyJob[i]["LN"])
            notifyCardsImage.setAttribute("src", imageProfile);
            notifyCardsImage.setAttribute("alt", "Image");
            notifyCards.append(notifyCardsImage);

            let applierDetails = document.createElement("div");
            applierDetails.setAttribute("class", "applierDetails");
            notifyCards.append(applierDetails);

            let name = document.createElement("p");
            name.setAttribute("class", "name");
            name.innerHTML = `${applyJob[i]["applierName"]}`;
            applierDetails.append(name);

            let jobId = document.createElement("p");
            jobId.innerHTML = `Job Id : ${applyJob[i]["jobID"]}`;
            jobId.setAttribute("class", "jobId");
            applierDetails.append(jobId);

            let buttons = document.createElement("div");
            buttons.setAttribute("class", "buttons");
            notifyCards.append(buttons);

            let b1 = document.createElement("div");
            b1.setAttribute("class", "b1");
            buttons.append(b1);

            // Check the stage of the notification and create button respective buttons
            let Approve = document.createElement("a");
            Approve.setAttribute("id", "approve")
            if (applyJob[i]["notificationAction"] == "Approved") {
                Approve.innerHTML = "Approved";
                console.log("Approved");
            }
            else {
                Approve.innerHTML = "Approve";
                Approve.setAttribute("onclick", `aprove(${applyJob[i]["aplliedJobId"]})`);
            }

            b1.append(Approve);

            let Reject = document.createElement("a");
            Reject.setAttribute("id", "reject");
            if (applyJob[i]["notificationAction"] == "Rejected") {
                Reject.innerHTML = "Rejected";
            }
            else {
                Reject.innerHTML = "Reject";
                Reject.setAttribute("onclick", `reject(${applyJob[i]["aplliedJobId"]})`)
            }

            b1.append(Reject);

            let b2 = document.createElement("div");
            b2.setAttribute("class", "b2");
            buttons.append(b2);

            let Readed = document.createElement("a");
            if (applyJob[i]["readed"] == true) {
                Readed.innerHTML = "Read";
            }
            else {
                Readed.innerHTML = "Read";
                Readed.setAttribute("onclick", `readed(${applyJob[i]["aplliedJobId"]})`)
            }
            Readed.innerHTML = "Read";
            Readed.setAttribute("onclick", `readed(${applyJob[i]["aplliedJobId"]})`)
            b2.append(Readed);

            let details = document.createElement("a");
            details.innerHTML = "Details";
            details.setAttribute("onclick", `setCurrentNotificationId(${applyJob[i]["aplliedJobId"]})`)
            b2.append(details);

            document.querySelector(".notificationEntire").append(notifications);
        }













    </script>
</body>

</html>